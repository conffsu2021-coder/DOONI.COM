<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="DOONI.COM - Oltiariqdagi eng sifatli va hamyonbop oziq-ovqatlar do'koni.">
    <title>DOONI.COM | Professional Market</title>
    
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #27ae60;
            --secondary: #2ecc71;
            --dark: #2c3e50;
            --light: #f4f7f6;
            --white: #ffffff;
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--light); color: var(--dark); line-height: 1.6; }

        /* --- Header & Nav --- */
        header {
            background: var(--white);
            padding: 1rem 5%;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary); text-decoration: none; }
        
        .search-bar { flex: 0.5; position: relative; }
        .search-bar input {
            width: 100%; padding: 10px 40px 10px 20px;
            border-radius: 25px; border: 1px solid #ddd; outline: none;
            transition: var(--transition);
        }
        .search-bar input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1); }
        .search-bar i { position: absolute; right: 15px; top: 12px; color: #999; }

        .nav-actions { display: flex; gap: 20px; align-items: center; }
        .cart-btn, .admin-btn { 
            position: relative; cursor: pointer; font-size: 1.2rem; color: var(--dark); 
            background: none; border: none; transition: var(--transition);
        }
        .cart-btn:hover, .admin-btn:hover { color: var(--primary); }
        #cart-count {
            position: absolute; top: -8px; right: -10px;
            background: #e74c3c; color: white; font-size: 10px;
            padding: 2px 6px; border-radius: 50%;
        }

        /* --- Categories --- */
        .categories {
            display: flex; justify-content: center; gap: 15px; padding: 20px 5%;
            overflow-x: auto; white-space: nowrap;
        }
        .cat-pill {
            padding: 8px 20px; background: var(--white); border-radius: 20px;
            cursor: pointer; font-weight: 600; font-size: 0.9rem;
            transition: var(--transition); border: 1px solid transparent;
        }
        .cat-pill.active { background: var(--primary); color: white; }
        .cat-pill:hover:not(.active) { border-color: var(--primary); color: var(--primary); }

        /* --- Product Grid --- */
        .container { padding: 20px 5%; max-width: 1300px; margin: 0 auto; }
        .product-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 25px;
        }
        .product-card {
            background: var(--white); border-radius: 15px; overflow: hidden;
            box-shadow: var(--shadow); transition: var(--transition);
            display: flex; flex-direction: column;
        }
        .product-card:hover { transform: translateY(-5px); }
        .product-img { width: 100%; height: 200px; object-fit: cover; }
        .product-info { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; }
        .product-category { font-size: 0.75rem; color: var(--primary); font-weight: 700; text-transform: uppercase; }
        .product-title { font-size: 1.1rem; margin: 5px 0; font-weight: 600; }
        .product-price { font-size: 1.2rem; font-weight: 700; color: var(--dark); margin-bottom: 15px; }

        .qty-control {
            display: flex; align-items: center; justify-content: space-between;
            background: #f8f9fa; border-radius: 8px; margin-bottom: 10px;
        }
        .qty-btn { border: none; background: none; padding: 10px 15px; cursor: pointer; font-size: 1.1rem; }
        .add-to-cart {
            background: var(--primary); color: white; border: none;
            padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer;
            transition: var(--transition);
        }
        .add-to-cart:hover { background: #219150; }

        /* --- Modals (Cart & Admin) --- */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;
        }
        .modal-content {
            background: var(--white); padding: 30px; border-radius: 20px;
            width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto;
            position: relative;
        }
        .close-modal { position: absolute; top: 20px; right: 20px; cursor: pointer; font-size: 1.5rem; }

        /* --- Form Style --- */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; outline: none;
        }

        /* --- AI Chatbot --- */
        #ai-widget {
            position: fixed; bottom: 20px; right: 20px; z-index: 3000;
        }
        .chat-bubble {
            width: 60px; height: 60px; background: var(--primary);
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            color: white; font-size: 1.5rem; cursor: pointer; box-shadow: var(--shadow);
        }
        .chat-window {
            display: none; position: absolute; bottom: 80px; right: 0;
            width: 320px; background: white; border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2); flex-direction: column; overflow: hidden;
        }
        .chat-header { background: var(--primary); color: white; padding: 15px; font-weight: 700; }
        .chat-body { height: 300px; overflow-y: auto; padding: 15px; font-size: 0.9rem; }
        .chat-footer { padding: 10px; border-top: 1px solid #eee; display: flex; }
        .chat-footer input { flex: 1; border: none; outline: none; padding: 5px; }
        .bot-msg { background: #f0f0f0; padding: 8px 12px; border-radius: 12px; margin-bottom: 10px; align-self: flex-start; }
        .user-msg { background: var(--primary); color: white; padding: 8px 12px; border-radius: 12px; margin-bottom: 10px; align-self: flex-end; text-align: right; }

        @media (max-width: 768px) {
            header { flex-wrap: wrap; gap: 10px; }
            .search-bar { order: 3; flex: 1 1 100%; }
            .product-grid { grid-template-columns: 1fr 1fr; gap: 15px; }
        }
    </style>
</head>
<body>

    <header>
        <a href="#" class="logo">DOONI.COM</a>
        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" id="mainSearch" placeholder="Mahsulotlarni qidirish..." onkeyup="app.filterProducts()">
        </div>
        <div class="nav-actions">
            <button class="admin-btn" onclick="app.toggleModal('admin-modal')" title="Admin Panel"><i class="fas fa-plus-circle"></i></button>
            <div class="cart-btn" onclick="app.toggleModal('cart-modal')">
                <i class="fas fa-shopping-cart"></i>
                <span id="cart-count">0</span>
            </div>
        </div>
    </header>

    <div class="categories" id="categoryContainer">
        <!-- JS orqali to'ldiriladi -->
    </div>

    <main class="container">
        <div class="product-grid" id="productGrid">
            <!-- Mahsulot kartalari JS orqali keladi -->
        </div>
    </main>

    <!-- Savat Modali -->
    <div id="cart-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="app.toggleModal('cart-modal')">&times;</span>
            <h2>Sizning savatingiz</h2>
            <div id="cartItems" style="margin: 20px 0;"></div>
            <div id="checkoutForm" style="display:none;">
                <h3>Buyurtmani rasmiylashtirish</h3>
                <div class="form-group">
                    <label>Ismingiz</label>
                    <input type="text" id="orderName" placeholder="Alisher">
                </div>
                <div class="form-group">
                    <label>Telefon raqamingiz</label>
                    <input type="tel" id="orderPhone" value="+998">
                </div>
                <div class="form-group">
                    <label>Manzil</label>
                    <textarea id="orderAddress" rows="2" placeholder="Oltiariq t, ..."></textarea>
                </div>
                <button class="add-to-cart" style="width: 100%;" onclick="app.submitOrder()">Buyurtmani yuborish</button>
            </div>
            <div id="cartFooter">
                <h3 id="cartTotal">Jami: 0 so'm</h3>
                <button class="add-to-cart" style="width: 100%; margin-top: 15px;" onclick="app.showCheckout()">Checkout</button>
            </div>
        </div>
    </div>

    <!-- Admin Panel (Mahsulot qo'shish) -->
    <div id="admin-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="app.toggleModal('admin-modal')">&times;</span>
            <h2>Yangi mahsulot qo'shish</h2>
            <div class="form-group">
                <label>Nomi</label>
                <input type="text" id="pName">
            </div>
            <div class="form-group">
                <label>Kategoriya</label>
                <select id="pCat">
                    <option value="Yog'">Yog'</option>
                    <option value="Un">Un</option>
                    <option value="Shakar">Shakar</option>
                    <option value="Guruch">Guruch</option>
                </select>
            </div>
            <div class="form-group">
                <label>Narxi (so'm)</label>
                <input type="number" id="pPrice">
            </div>
            <div class="form-group">
                <label>Rasm URL (yoki unsplash link)</label>
                <input type="text" id="pImg" value="https://images.unsplash.com/photo-1550989460-0adf9ea622e2?w=400">
            </div>
            <button class="add-to-cart" style="width: 100%;" onclick="app.addNewProduct()">Ro'yxatga qo'shish</button>
        </div>
    </div>

    <!-- AI Chatbot -->
    <div id="ai-widget">
        <div class="chat-window" id="chatWin">
            <div class="chat-header">Dooni AI Yordamchisi</div>
            <div class="chat-body" id="chatBody">
                <div class="bot-msg">Salom! Men Dooni AI yordamchisiman. Mahsulotlar, narxlar yoki yetkazib berish haqida so'rang.</div>
            </div>
            <div class="chat-footer">
                <input type="text" id="chatInput" placeholder="Savolingizni yozing..." onkeypress="if(event.key==='Enter') app.askAI()">
                <i class="fas fa-paper-plane" style="color:var(--primary); cursor:pointer;" onclick="app.askAI()"></i>
            </div>
        </div>
        <div class="chat-bubble" onclick="app.toggleChat()">
            <i class="fas fa-robot"></i>
        </div>
    </div>

    <script>
        const app = {
            products: JSON.parse(localStorage.getItem('products')) || [
                {id: 1, name: "O'simlik yog'i (1L)", price: 18500, cat: "Yog'", img: "https://images.unsplash.com/photo-1550989460-0adf9ea622e2?w=400"},
                {id: 2, name: "Oliy navli un (5kg)", price: 32000, cat: "Un", img: "https://images.unsplash.com/photo-1509440159596-0249088772ff?w=400"},
                {id: 3, name: "Shakar (1kg)", price: 12000, cat: "Shakar", img: "https://images.unsplash.com/photo-1527324688151-0e627063f2b1?w=400"},
                {id: 4, name: "Guruch Lazer (1kg)", price: 24000, cat: "Guruch", img: "https://images.unsplash.com/photo-1586201375761-83865001e31c?w=400"}
            ],
            cart: JSON.parse(localStorage.getItem('cart')) || [],
            currentCat: 'Barchasi',

            init() {
                this.renderCategories();
                this.renderProducts();
                this.updateCartUI();
            },

            renderCategories() {
                const cats = ['Barchasi', ...new Set(this.products.map(p => p.cat))];
                const container = document.getElementById('categoryContainer');
                container.innerHTML = cats.map(c => `
                    <div class="cat-pill ${this.currentCat === c ? 'active' : ''}" onclick="app.setCategory('${c}')">${c}</div>
                `).join('');
            },

            setCategory(cat) {
                this.currentCat = cat;
                this.renderCategories();
                this.renderProducts();
            },

            renderProducts() {
                const query = document.getElementById('mainSearch').value.toLowerCase();
                const grid = document.getElementById('productGrid');
                
                const filtered = this.products.filter(p => {
                    const matchCat = this.currentCat === 'Barchasi' || p.cat === this.currentCat;
                    const matchQuery = p.name.toLowerCase().includes(query);
                    return matchCat && matchQuery;
                });

                grid.innerHTML = filtered.map(p => `
                    <article class="product-card">
                        <img src="${p.img}" class="product-img" alt="${p.name}">
                        <div class="product-info">
                            <span class="product-category">${p.cat}</span>
                            <h3 class="product-title">${p.name}</h3>
                            <p class="product-price">${p.price.toLocaleString()} so'm</p>
                            <button class="add-to-cart" onclick="app.addToCart(${p.id})">
                                <i class="fas fa-cart-plus"></i> Savatga qo'shish
                            </button>
                        </div>
                    </article>
                `).join('');
            },

            filterProducts() { this.renderProducts(); },

            addToCart(id) {
                const product = this.products.find(p => p.id === id);
                const inCart = this.cart.find(i => i.id === id);
                if (inCart) {
                    inCart.qty++;
                } else {
                    this.cart.push({...product, qty: 1});
                }
                this.saveCart();
                this.updateCartUI();
                alert(`${product.name} savatga qo'shildi!`);
            },

            updateCartUI() {
                const count = this.cart.reduce((sum, item) => sum + item.qty, 0);
                document.getElementById('cart-count').innerText = count;
                
                const list = document.getElementById('cartItems');
                let total = 0;
                list.innerHTML = this.cart.map(item => {
                    total += item.price * item.qty;
                    return `
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px;">
                            <div><b>${item.name}</b><br>${item.qty} x ${item.price.toLocaleString()}</div>
                            <div style="display:flex; align-items:center; gap:10px;">
                                <button onclick="app.changeQty(${item.id}, -1)">-</button>
                                <span>${item.qty}</span>
                                <button onclick="app.changeQty(${item.id}, 1)">+</button>
                            </div>
                        </div>
                    `;
                }).join('');
                document.getElementById('cartTotal').innerText = `Jami: ${total.toLocaleString()} so'm`;
            },

            changeQty(id, delta) {
                const item = this.cart.find(i => i.id === id);
                item.qty += delta;
                if (item.qty <= 0) this.cart = this.cart.filter(i => i.id !== id);
                this.saveCart();
                this.updateCartUI();
            },

            saveCart() { localStorage.setItem('cart', JSON.stringify(this.cart)); },

            toggleModal(id) {
                const m = document.getElementById(id);
                m.style.display = (m.style.display === 'flex') ? 'none' : 'flex';
            },

            showCheckout() {
                if (this.cart.length === 0) return alert("Savatingiz bo'sh!");
                document.getElementById('checkoutForm').style.display = 'block';
                document.getElementById('cartFooter').style.display = 'none';
            },

            submitOrder() {
                const name = document.getElementById('orderName').value;
                const phone = document.getElementById('orderPhone').value;
                const address = document.getElementById('orderAddress').value;

                if (!name || phone.length < 9) return alert("Ma'lumotlarni to'liq kiriting!");

                let msg = `ðŸ› *Yangi Buyurtma (DOONI.COM)*\n\n`;
                msg += `ðŸ‘¤ Mijoz: ${name}\nðŸ“ž Tel: ${phone}\nðŸ“ Manzil: ${address}\n\n`;
                msg += `ðŸ“¦ Mahsulotlar:\n`;
                this.cart.forEach(i => msg += `- ${i.name} (${i.qty} ta)\n`);
                msg += `\nðŸ’° *Jami: ${this.cart.reduce((s,i)=>s+(i.price*i.qty),0).toLocaleString()} so'm*`;

                const telLink = `https://t.me/ddd2279?text=${encodeURIComponent(msg)}`;
                window.open(telLink, '_blank');
                this.cart = [];
                this.saveCart();
                location.reload();
            },

            addNewProduct() {
                const newP = {
                    id: Date.now(),
                    name: document.getElementById('pName').value,
                    price: parseInt(document.getElementById('pPrice').value),
                    cat: document.getElementById('pCat').value,
                    img: document.getElementById('pImg').value
                };
                if (!newP.name || !newP.price) return alert("Xatolik!");
                this.products.push(newP);
                localStorage.setItem('products', JSON.stringify(this.products));
                alert("Mahsulot qo'shildi!");
                this.toggleModal('admin-modal');
                this.init();
            },

            // --- AI Logic ---
            toggleChat() {
                const win = document.getElementById('chatWin');
                win.style.display = (win.style.display === 'flex') ? 'none' : 'flex';
            },

            askAI() {
                const inp = document.getElementById('chatInput');
                const text = inp.value.toLowerCase();
                if (!text) return;

                const body = document.getElementById('chatBody');
                body.innerHTML += `<div class="user-msg">${inp.value}</div>`;
                inp.value = '';

                setTimeout(() => {
                    let reply = "Kechirasiz, buni tushunmadim. Mahsulotlarimiz haqida so'rang yoki operatorga bog'laning: +998938745002";
                    
                    if (text.includes('narx') || text.includes('qancha')) {
                        const prices = this.products.map(p => `${p.name}: ${p.price} so'm`).join('\n');
                        reply = "Bizdagi mahsulotlar narxlari:\n" + prices;
                    } else if (text.includes('yetkazib') || text.includes('dostavka')) {
                        reply = "Oltiariq tumanida yetkazib berish 1 soat ichida bepul! Viloyat bo'ylab kelishiladi.";
                    } else if (text.includes('salom') || text.includes('assalom')) {
                        reply = "Assalomu alaykum! DOONI do'koniga xush kelibsiz. Sizga nima yordam bera olaman?";
                    } else if (text.includes('yog') || text.includes('un')) {
                        reply = "Bizda eng sara va yangi un hamda yog' mahsulotlari bor. Hozirgi narxlar saytda ko'rsatilgan.";
                    }

                    body.innerHTML += `<div class="bot-msg">${reply}</div>`;
                    body.scrollTop = body.scrollHeight;
                }, 600);
            }
        };

        app.init();
    </script>
</body>
</html>
